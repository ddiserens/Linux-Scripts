#!/bin/bash 
#set -x
#Functions
select_run ()
{
export CDDIR="/media/dvd"
export DIR="/tmp/compliancecheck"
export COMPLIANCE="${DIR}/log/compliance.log"

case "$1" in
	-a|--all)
		complete_check $1
		;;
	-c|--check)
		check_system $1
		;;
	-f|--fix)
		fix_system $1
		;;
	-r|--restore)
		restore_system $1 $2
		;;
	*)
		print_help
		exit 1
		;;
esac
}

complete_check ()
{
SCRIPT="/root/Desktop/stig/test/check_passwd_single_user.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_system_release.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_services.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_permissions.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_GID_passwd_file.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_banner.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_simultaneous_login.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_system_auth.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_screen_saver.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_login_def.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_passwd_hash.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi
}

check_system ()
{
if [ ! -f /tmp/compliancecheck/log ];then
	mkdir -p /tmp/compliancecheck/log 
fi
SCRIPT="/root/Desktop/stig/test/check_passwd_single_user.sh" 
if [ -x "${SCRIPT}" ]; then
	${SCRIPT} $1 
fi

SCRIPT="/root/Desktop/stig/test/check_system_release.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_services.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_permissions.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_GID_passwd_file.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_banner.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_simultaneous_login.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_system_auth.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_screen_saver.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_login_def.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_passwd_hash.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi
}

fix_system ()
{
SCRIPT="/root/Desktop/stig/test/check_passwd_single_user.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_system_release.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_services.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_permissions.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_GID_passwd_file.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_banner.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_simultaneous_login.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_system_auth.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_screen_saver.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_login_def.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_passwd_hash.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi
}

restore_system ()
{
SCRIPT="/root/Desktop/stig/test/check_passwd_single_user.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1 $2
fi

SCRIPT="/root/Desktop/stig/test/check_system_release.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_permissions.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_GID_passwd_file.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_banner.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_simultaneous_login.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_system_auth.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_screen_saver.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_login_def.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi

SCRIPT="/root/Desktop/stig/test/check_passwd_hash.sh"
if [ -x "${SCRIPT}" ]; then
        ${SCRIPT} $1
fi
}

control ()
{
C10LINE=`gconftool-2 --direct --config-source xml:readwrite:/etc/gconf/gconf.xml.mandatory --type bool --set /apps/gnome-screensaver/idle_activation_enabled true`
C11LINE=`passwd -n 1`

#Checks STIG ID - GEN000500 the Red Hat Enterprise Linux 5 STIG to see if its compliant
if [ `${C10LINE}` != "" ]; then
        C10="T"
        echo "GEN000500 - Passed" > ${COMPLIANCE}
else
        C10="F"
        echo "GEN000500 - Failed" >> ${COMPLIANCE}
fi

}

control2 ()
{
#Runs fix for STIG ID - GEN000380 the Red Hat Enterprise Linux 5 STIG
if [ `${C6}` == "T" ]; then
        echo ""
else
        echo "Fixing STIG ID - GEN000380"
	FIXC6=`${C6CHECK} | awk -F"=" { print $2 }`
	sed -e 's/${FIXC6}/100/ig' ${C6FILE}
fi	

#Runs fix for STIG ID - GEN000500 the Red Hat Enterprise Linux 5 STIG
if [ `${C10}` == "T" ]; then
        echo ""
else
        echo "Fixing STIG ID - GEN000500"

fi

}

print_help () 
{
echo ""
echo "Usage: $0 [OPTION]"
echo ""
echo "Arguments:"
echo "	or: $0 -a, --all		Runs a check then fixes all the errors"
echo "	or: $0 -c, --check		Runs a check on the system"
echo "	or: $0 -f, --fix		Runs a through every fix"
echo "	or: $0 -r, --restore		Restores settings back to what they were before the program was ran"
echo "	or: $0 -h, --help"
}

clear
if [[ "$1" = "" ]]; then
	select_run -h
else
	select_run $*
fi

